!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("cross-fetch")):"function"==typeof define&&define.amd?define(["exports","cross-fetch"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).authorizerdev={},e.crossFetch)}(this,(function(e,t){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=r(t);
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function o(e,t,r,i){return new(r||(r=Promise))((function(o,n){function s(e){try{d(i.next(e))}catch(e){n(e)}}function a(e){try{d(i.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}d((i=i.apply(e,t||[])).next())}))}var n,s;e.OAuthProviders=void 0,(n=e.OAuthProviders||(e.OAuthProviders={})).Apple="apple",n.Github="github",n.Google="google",n.Facebook="facebook",n.LinkedIn="linkedin",e.ResponseTypes=void 0,(s=e.ResponseTypes||(e.ResponseTypes={})).Code="code",s.Token="token";const a=()=>"undefined"!=typeof window,d=e=>{let t=e.trim();return"/"===t[t.length-1]&&(t=t.slice(0,-1)),t},h=()=>a()?window.crypto||window.msCrypto:null,c=()=>{const e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_~.";let t="";const r=h();if(r){Array.from(r.getRandomValues(new Uint8Array(43))).forEach((r=>t+=e[r%e.length]))}return t},u=e=>a()?btoa(e):Buffer.from(e).toString("base64"),l=e=>o(void 0,void 0,void 0,(function*(){const t=(()=>{const e=h();return e&&e.subtle||e.webkitSubtle})().digest({name:"SHA-256"},(new TextEncoder).encode(e));return window.msCrypto?new Promise(((e,r)=>{t.oncomplete=t=>{e(t.target.result)},t.onerror=e=>{r(e.error)},t.onabort=()=>{r("The digest operation was aborted")}})):yield t})),f="id email email_verified given_name family_name middle_name nickname preferred_username picture signup_methods gender birthdate phone_number phone_number_verified roles created_at updated_at is_multi_factor_auth_enabled ",p=`message access_token expires_in refresh_token id_token should_show_otp_screen user { ${f} }`,g=()=>a()?window.fetch:i.default;e.Authorizer=class{constructor(t){if(this.authorize=t=>o(this,void 0,void 0,(function*(){if(!a())throw new Error("this feature is only supported in browser");const r=["openid","profile","email"];t.use_refresh_token&&r.push("offline_access");const i={redirect_uri:this.config.redirectURL,response_mode:t.response_mode||"web_message",state:u(c()),nonce:u(c()),response_type:t.response_type,scope:r.join(" "),client_id:this.config.clientID};if(t.response_type===e.ResponseTypes.Code){this.codeVerifier=c();const e=(e=>{const t=new Uint8Array(e);return(e=>{const t={"+":"-","/":"_","=":""};return e.replace(/[+/=]/g,(e=>t[e]))})(window.btoa(String.fromCharCode(...Array.from(t))))})(yield l(this.codeVerifier));i.code_challenge=e}const o=`${this.config.authorizerURL}/authorize?${n=i,Object.keys(n).filter((e=>void 0!==n[e])).map((e=>encodeURIComponent(e)+"="+encodeURIComponent(n[e]))).join("&")}`;var n;try{const r=yield((e,t,r=60)=>new Promise(((i,o)=>{const n=window.document.createElement("iframe");n.setAttribute("id","authorizer-iframe"),n.setAttribute("width","0"),n.setAttribute("height","0"),n.style.display="none";const s=()=>{window.document.body.contains(n)&&(window.document.body.removeChild(n),window.removeEventListener("message",a,!1))};let a;const d=setTimeout((()=>{s()}),1e3*r);a=function(e){if(e.origin!=t)return;if(!e.data||!e.data.response)return;const r=e.source;r&&r.close(),e.data.response.error?o(e.data.response):i(e.data.response),clearTimeout(d),window.removeEventListener("message",a,!1),setTimeout(s,2e3)},window.addEventListener("message",a,!1),window.document.body.appendChild(n),n.setAttribute("src",e)})))(o,this.config.authorizerURL,60);if(t.response_type===e.ResponseTypes.Code){return yield this.getToken({code:r.code})}return r}catch(e){throw e.error&&window.location.replace(`${this.config.authorizerURL}/app?state=${u(JSON.stringify(this.config))}&redirect_uri=${this.config.redirectURL}`),e}})),this.browserLogin=()=>o(this,void 0,void 0,(function*(){try{return yield this.getSession()}catch(e){if(!a())throw new Error("browserLogin is only supported for browsers");window.location.replace(`${this.config.authorizerURL}/app?state=${u(JSON.stringify(this.config))}&redirect_uri=${this.config.redirectURL}`)}})),this.forgotPassword=e=>o(this,void 0,void 0,(function*(){e.state||(e.state=u(c())),e.redirect_uri||(e.redirect_uri=this.config.redirectURL);try{return(yield this.graphqlQuery({query:"mutation forgotPassword($data: ForgotPasswordInput!) {\tforgot_password(params: $data) { message } }",variables:{data:e}})).forgot_password}catch(e){throw e}})),this.getMetaData=()=>o(this,void 0,void 0,(function*(){try{return(yield this.graphqlQuery({query:"query { meta { version is_google_login_enabled is_vk_login_enabled is_facebook_login_enabled is_github_login_enabled is_linkedin_login_enabled is_apple_login_enabled is_twitter_login_enabled is_email_verification_enabled is_basic_authentication_enabled is_magic_link_login_enabled is_sign_up_enabled is_strong_password_enabled } }"})).meta}catch(e){throw e}})),this.getProfile=e=>o(this,void 0,void 0,(function*(){try{return(yield this.graphqlQuery({query:`query {\tprofile { ${f} } }`,headers:e})).profile}catch(e){throw e}})),this.getSession=(e,t)=>o(this,void 0,void 0,(function*(){try{return(yield this.graphqlQuery({query:`query getSession($params: SessionQueryInput){session(params: $params) { ${p} } }`,headers:e,variables:{params:t}})).session}catch(e){throw e}})),this.getToken=e=>o(this,void 0,void 0,(function*(){if(e.grant_type||(e.grant_type="authorization_code"),"refresh_token"===e.grant_type&&!e.refresh_token)throw new Error("Invalid refresh_token");if("authorization_code"===e.grant_type&&!this.codeVerifier)throw new Error("Invalid code verifier");const t={client_id:this.config.clientID,code:e.code||"",code_verifier:this.codeVerifier||"",grant_type:e.grant_type||"",refresh_token:e.refresh_token||""};try{const e=g(),r=yield e(`${this.config.authorizerURL}/oauth/token`,{method:"POST",body:JSON.stringify(t),headers:Object.assign({},this.config.extraHeaders),credentials:"include"}),i=yield r.json();if(r.status>=400)throw new Error(i);return i}catch(e){throw e}})),this.graphqlQuery=e=>o(this,void 0,void 0,(function*(){const t=g(),r=yield t(this.config.authorizerURL+"/graphql",{method:"POST",body:JSON.stringify({query:e.query,variables:e.variables||{}}),headers:Object.assign(Object.assign({},this.config.extraHeaders),e.headers||{}),credentials:"include"}),i=yield r.json();if(i.errors&&i.errors.length)throw console.error(i.errors),new Error(i.errors[0].message);return i.data})),this.login=e=>o(this,void 0,void 0,(function*(){try{return(yield this.graphqlQuery({query:`\n\t\t\t\t\tmutation login($data: LoginInput!) { login(params: $data) { ${p}}}\n\t\t\t\t`,variables:{data:e}})).login}catch(e){throw e}})),this.logout=e=>o(this,void 0,void 0,(function*(){try{return(yield this.graphqlQuery({query:" mutation { logout { message } } ",headers:e})).logout}catch(e){console.error(e)}})),this.magicLinkLogin=e=>o(this,void 0,void 0,(function*(){try{e.state||(e.state=u(c())),e.redirect_uri||(e.redirect_uri=this.config.redirectURL);return(yield this.graphqlQuery({query:"\n\t\t\t\t\tmutation magicLinkLogin($data: MagicLinkLoginInput!) { magic_link_login(params: $data) { message }}\n\t\t\t\t",variables:{data:e}})).magic_link_login}catch(e){throw e}})),this.oauthLogin=(t,r,i,n)=>o(this,void 0,void 0,(function*(){let o=n;if(o||(o=u(c())),!Object.values(e.OAuthProviders).includes(t))throw new Error(`only following oauth providers are supported: ${Object.values(t).toString()}`);if(!a())throw new Error("oauthLogin is only supported for browsers");window.location.replace(`${this.config.authorizerURL}/oauth_login/${t}?redirect_uri=${i||this.config.redirectURL}&state=${o}${r&&r.length?`&roles=${r.join(",")}`:""}`)})),this.resendOtp=e=>o(this,void 0,void 0,(function*(){try{return(yield this.graphqlQuery({query:"\n\t\t\t\t\tmutation resendOtp($data: ResendOTPRequest!) { resend_otp(params: $data) { message }}\n\t\t\t\t",variables:{data:e}})).resend_otp}catch(e){throw e}})),this.resetPassword=e=>o(this,void 0,void 0,(function*(){try{return(yield this.graphqlQuery({query:"mutation resetPassword($data: ResetPasswordInput!) {\treset_password(params: $data) { message } }",variables:{data:e}})).reset_password}catch(e){throw e}})),this.revokeToken=e=>o(this,void 0,void 0,(function*(){if(!e.refresh_token&&!e.refresh_token.trim())throw new Error("Invalid refresh_token");const t=g(),r=yield t(this.config.authorizerURL+"/oauth/revoke",{method:"POST",headers:Object.assign({},this.config.extraHeaders),body:JSON.stringify({refresh_token:e.refresh_token,client_id:this.config.clientID})});return yield r.json()})),this.signup=e=>o(this,void 0,void 0,(function*(){try{return(yield this.graphqlQuery({query:`\n\t\t\t\t\tmutation signup($data: SignUpInput!) { signup(params: $data) { ${p}}}\n\t\t\t\t`,variables:{data:e}})).signup}catch(e){throw e}})),this.updateProfile=(e,t)=>o(this,void 0,void 0,(function*(){try{return(yield this.graphqlQuery({query:"mutation updateProfile($data: UpdateProfileInput!) {\tupdate_profile(params: $data) { message } }",headers:t,variables:{data:e}})).update_profile}catch(e){throw e}})),this.validateJWTToken=e=>o(this,void 0,void 0,(function*(){try{return(yield this.graphqlQuery({query:"query validateJWTToken($params: ValidateJWTTokenInput!){validate_jwt_token(params: $params) { is_valid claims } }",variables:{params:e}})).validate_jwt_token}catch(e){throw e}})),this.verifyEmail=e=>o(this,void 0,void 0,(function*(){try{return(yield this.graphqlQuery({query:`\n\t\t\t\t\tmutation verifyEmail($data: VerifyEmailInput!) { verify_email(params: $data) { ${p}}}\n\t\t\t\t`,variables:{data:e}})).verify_email}catch(e){throw e}})),this.verifyOtp=e=>o(this,void 0,void 0,(function*(){try{return(yield this.graphqlQuery({query:`\n\t\t\t\t\tmutation verifyOtp($data: VerifyOTPRequest!) { verify_otp(params: $data) { ${p}}}\n\t\t\t\t`,variables:{data:e}})).verify_otp}catch(e){throw e}})),!t)throw new Error("Configuration is required");if(this.config=t,!t.authorizerURL&&!t.authorizerURL.trim())throw new Error("Invalid authorizerURL");if(t.authorizerURL&&(this.config.authorizerURL=d(t.authorizerURL)),!t.redirectURL&&!t.redirectURL.trim())throw new Error("Invalid redirectURL");this.config.redirectURL=d(t.redirectURL),this.config.extraHeaders=Object.assign(Object.assign({},t.extraHeaders||{}),{"x-authorizer-url":this.config.authorizerURL,"Content-Type":"application/json"}),this.config.clientID=t.clientID.trim()}}}));
//# sourceMappingURL=authorizer.min.js.map
